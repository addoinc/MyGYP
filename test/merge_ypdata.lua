YPData = {
	["Akama-Alliance"] = {
		["Jewelcrafting"] = {
			["Killaseason"] = {
				["message"] = "|cffffd000[Jewelcrafting]|h|r  LFW, Your Mats, Love Tips. PST",
				["level"] = 450,
				["time"] = 1251377224,
				["link"] = "|cffffd000|Htrade:51311:450:450:380000001FA5B36:8/6UsqMtLyjpmMHAAAAwHAAAg/Bg/vBAAAAAAA+BAAAA6/37v77e2f1ezC6vyUsQHKDhizgEoAA8/D8Pg/BAAYAECAAAAAA|h[Jewelcrafting]|h|r",
			},
		},
		["Enchanting"] = {
			["Khad"] = {
				["message"] = " |cffffd000[Enchanting]|h|r lfw       ---   |cffffd000|Henchant:60616|h[Enchant Bracers - Striking]|h|r free",
				["level"] = 363,
				["time"] = 1251377179,
				["link"] = "|cffffd000|Htrade:51313:363:450:380000000260552:4/q777a8f5Z7msyn/LLPICgAwBGABsAA7WzC1EAAAABAAgGAAAC|h[Enchanting]|h|r",
			},
		},
	},

	["Jubei'Thos-Alliance"] = {
		["Inscription"] = {
			["Colmacftw"] = {
				["message"] = "LFW|cffffd000[Inscription]|h|r!  Your mats, not mine, tips appreciated.  If I get a skill up, you get 10g!",
				["level"] = 165,
				["time"] = 1252855762,
				["link"] = "|cffffd000|Htrade:45359:165:225:380000002FDE0B1:E/gBD6HAAAwDg/AA8DAwPAA+BA+BAwPAA+BAwPAAGYgBgggQPhJAKA/BAAAAAAAAAAAAAAAAAgA|h[Inscription]|h|r",
			},
		},
		["Blacksmithing"] = {
			["Pintados"] = {
				["message"] = "==== |cffffd000[Blacksmithing]|h|r =====",
				["level"] = 450,
				["time"] = 1252924775,
				["link"] = "|cffffd000|Htrade:51300:450:450:3800000026C17C8:2v22MAjCicMA/FoJ5TAyg+RMAAAAUAAAfAAAAAAA8/LHAAQAAASDAA6BAAAAAAA/L6rgCAwP1///fDQAYAAw/7H|h[Blacksmithing]|h|r",
			},
			["Devilfirelol"] = {
				["message"] = "Devil's  |cffffd000[Blacksmithing]|h|r  6/6 uld pattens",
				["level"] = 450,
				["time"] = 1252921218,
				["link"] = "|cffffd000|Htrade:51300:450:450:3800000024B685C:2v2+dYjCieMA/FoJ5zqyh+BNAhAAUACAfAAAAAAA8/DAAgwQBAwDAA+BAAACMmA////w/fw//////////vIw//H|h[Blacksmithing]|h|r",
			},
			["hasnewerversion"] = {
				["message"] = "Devil's  |cffffd000[Blacksmithing]|h|r  6/6 uld pattens",
				["level"] = 450,
				["time"] = 1252921218,
				["link"] = "|cffffd000|Htrade:51300:450:450:3800000024B685C:2v2+dYjCieMA/FoJ5zqyh+BNAhAAUACAfAAAAAAA8/DAAgwQBAwDAA+BAAACMmA////w/fw//////////vIw//H|h[Blacksmithing]|h|r",
			},
		},
	},
}

ZLData = {
	["Jubei'Thos-Alliance"] = {
		["Blacksmithing"] = {
			["Pintados"] = {
				["message"] = "==== |cffffd000[Blacksmithing]|h|r =====",
				["level"] = 450,
				["time"] = 1252924775,
				["link"] = "|cffffd000|Htrade:51300:450:450:3800000026C17C8:2v22MAjCicMA/FoJ5TAyg+RMAAAAUAAAfAAAAAAA8/LHAAQAAASDAA6BAAAAAAA/L6rgCAwP1///fDQAYAAw/7H|h[Blacksmithing]|h|r",
			},
			["Devilfirelol"] = {
				["message"] = "Devil's  |cffffd000[Blacksmithing]|h|r  6/6 uld pattens",
				["level"] = 450,
				["time"] = 1252921218,
				["link"] = "|cffffd000|Htrade:51300:450:450:3800000024B685C:2v2+dYjCieMA/FoJ5zqyh+BNAhAAUACAfAAAAAAA8/DAAgwQBAwDAA+BAAACMmA////w/fw//////////vIw//H|h[Blacksmithing]|h|r",
			},
			["iamnotinypdata"] = {
				["message"] = "Devil's  |cffffd000[Blacksmithing]|h|r  6/6 uld pattens",
				["level"] = 450,
				["time"] = 1252921218,
				["link"] = "|cffffd000|Htrade:51300:450:450:3800000024B685C:2v2+dYjCieMA/FoJ5zqyh+BNAhAAUACAfAAAAAAA8/DAAgwQBAwDAA+BAAACMmA////w/fw//////////vIw//H|h[Blacksmithing]|h|r",
			},
			["hasnewerversion"] = {
				["message"] = "Devil's  |cffffd000[Blacksmithing]|h|r  6/6 uld pattens",
				["level"] = 450,
				["time"] = 1252921219,
				["link"] = "|cffffd000|Htrade:51300:450:450:3800000024B685C:2v2+dYjCieMA/FoJ5zqyh+BNAhAAUACAfAAAAAAA8/DAAgwQBAwDAA+BAAACMmA////w/fw//////////vIw//H|h[Blacksmithing]|h|r",
			},
		},
		["Tailoring"] = {
			["Bibier"] = {
				["message"] = "lfw |cffffd000[Tailoring]|h|r",
				["level"] = 435,
				["time"] = 1252919948,
				["link"] = "|cffffd000|Htrade:51309:435:450:380000002CA47EE:4+//vvoIydmB8/PR07CRtTDIyV/nNzlLAAgCA4EB8DAIBAAAAAFAAAAA+////DPW7v69/fwAA|h[Tailoring]|h|r",
			},
			["Megwymon"] = {
				["message"] = "LFW |cffffd000[Tailoring]|h|r UR MATS TIP PLZ",
				["level"] = 411,
				["time"] = 1252917617,
				["link"] = "|cffffd000|Htrade:51309:411:450:38000000108A222:4+/+rqoIydiB4/PQ07CRtTBIyV3nNzlLAAAAAYAA4DAAAAAAQAFAAAAAi///GCBWDAwFgQwAA|h[Tailoring]|h|r",
			},
			["Mikèé"] = {
				["message"] = "LFW MAX |cffffd000[Tailoring]|h|r TIPS PST",
				["level"] = 450,
				["time"] = 1252921323,
				["link"] = "|cffffd000|Htrade:51309:450:450:380000002B5CE43:4////v67+/7v//v73/65t3nZ3//3N/nLpp/2x4HR8/XK//LQG+lBGAAo////f///7//9/f7GA|h[Tailoring]|h|r",
			},
		},
	},
}

function assert(a, b)
	if( a == b ) then
		print("SUCCESS")
		return true
	else
		print("FAILURE")
		return false
	end
end

function assert_not_nil(a)
	if(a == nil) then
		print("FAILURE")
		return false
	end
	print("SUCCESS")
	return true
end

local serverKey = "Jubei'Thos-Alliance"

assert(YPData[serverKey]["Blacksmithing"]["hasnewerversion"].time, 1252921218)

-- for each trade in ZLData corresponding to the current serverKey
for trade, adsList in pairs( ZLData[serverKey] ) do
	-- get the ad for each of the players
	for player, ad in pairs(adsList) do
		-- check if corresponding entry in YPData is present
		if( YPData[serverKey][trade] == nil ) then
			-- YPData didnt have the corresponding tradeslot
			YPData[serverKey][trade] = ZLData[serverKey][trade]
		elseif( YPData[serverKey][trade][player] == nil ) then
			-- YPData didnt have the corresponding player's entry
			YPData[serverKey][trade][player] = ZLData[serverKey][trade][player]
		elseif( YPData[serverKey][trade][player].time < ZLData[serverKey][trade][player].time ) then
			-- YPData had the entry for the given player but the ad in YPData was older than the ad in ZLData
			YPData[serverKey][trade][player] = {}
			YPData[serverKey][trade][player] = ZLData[serverKey][trade][player]
		end
	end
end

for trade, adsList in pairs( ZLData[serverKey] ) do
	if( trade == "Blacksmithing" or trade == "Tailoring" ) then
		for player, ad in pairs(adsList) do
			assert(YPData[serverKey][trade][player].message, ZLData[serverKey][trade][player].message)
			assert(YPData[serverKey][trade][player].level, ZLData[serverKey][trade][player].level)
			assert(YPData[serverKey][trade][player].time, ZLData[serverKey][trade][player].time)
			assert(YPData[serverKey][trade][player].link, ZLData[serverKey][trade][player].link)
		end
	end
end

assert(YPData[serverKey]["Blacksmithing"]["hasnewerversion"].time, 1252921219)
assert_not_nil(YPData[serverKey]["Blacksmithing"]["iamnotinypdata"])

assert_not_nil(YPData[serverKey]["Inscription"]["Colmacftw"].message)
assert_not_nil(YPData[serverKey]["Inscription"]["Colmacftw"].level)
assert_not_nil(YPData[serverKey]["Inscription"]["Colmacftw"].time)
assert_not_nil(YPData[serverKey]["Inscription"]["Colmacftw"].link)
